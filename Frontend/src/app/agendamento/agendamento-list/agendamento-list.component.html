<div class="agenda-wrapper">

  <!-- Miniatura do QR Code -->
  <div *ngIf="qrCodeBase64" class="qrcode-mini-thumb">
    <img [src]="qrCodeBase64.startsWith('data:image') ? qrCodeBase64 : 'data:image/png;base64,' + qrCodeBase64"
         alt="QR Code WhatsApp"
         title="Clique para ampliar"
         (click)="abrirQrCodeGrande()"
         style="width: 60px; height: 60px; cursor: pointer; border: 2px solid #4caf50; border-radius: 8px; box-shadow: 0 2px 6px #0002;" />
    <div style="font-size: 0.8rem; text-align: center;">WhatsApp</div>
  </div>

  <div class="agenda-header">
    <div class="agenda-logo-wrapper">
      <img src="assets/LOGOTIPO.png" alt="Logo Belle Clinic" class="agenda-logo" />
    </div>
    <div>
      <h1 class="agenda-title">Agenda Semanal</h1>
      <div class="agenda-nav">
        <button class="agenda-btn" (click)="navigateWeek('previous')">
          <i class="fa fa-chevron-left"></i> Semana Anterior
        </button>
        <span class="agenda-range">
          {{ currentWeekStart | date:'dd/MM/yyyy' }} - {{ currentWeekEnd | date:'dd/MM/yyyy' }}
        </span>
        <button class="agenda-btn" (click)="navigateWeek('next')">
          Próxima Semana <i class="fa fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

  <div class="agenda-days">
    <div class="agenda-day" *ngFor="let day of days">
      <div class="agenda-day-header">
        <span class="agenda-day-name">{{ day }}</span>
        <span class="agenda-day-date">{{ getDateForDay(day) | date:'dd/MM/yy' }}</span>
      </div>
      <div *ngIf="agendamentosPorData[day]?.length; else noAppointments">
        <div class="agenda-card"
             *ngFor="let appointment of agendamentosPorData[day]"
             (click)="detalharServico(appointment.CodAtend, appointment.CodCli)">
          
          <div *ngIf="isFiveMinutesBefore(appointment)" class="alert alert-warning p-1 mb-2 text-center" style="font-size:0.95rem;">
            <i class="fa fa-bell"></i> Atendimento irá iniciar em 5 minutos!
          </div>
          <div class="agenda-card-time">
            <i class="fa fa-clock"></i> {{ appointment.hora }}
          </div>
          <div class="agenda-card-client">
            <i class="fa fa-user"></i> {{ appointment.cliente }}
          </div>
          <div class="agenda-card-service">
            <i class="{{ getIconClass(appointment.servico) }}"></i> {{ appointment.servico }}
          </div>
          <!-- Botão WhatsApp -->
          <button class="zap-btn"
                  (click)="enviarZap(appointment, $event)"
                  title="Enviar WhatsApp">
            <i class="fa fa-whatsapp"></i>
          </button>
        </div>
      </div>
      <ng-template #noAppointments>
        <div class="agenda-card agenda-card-empty"
             style="cursor:pointer"
             (click)="novoAtendimento(day)">
          <i class="fa fa-calendar-times"></i> Nenhum agendamento
        </div>
      </ng-template>
    </div>
  </div>

  <!-- QR Code grande (modal ou caixa central) -->
  <div *ngIf="qrCodeGrandeVisivel" class="qrcode-sync-modal" (click)="fecharQrCodeGrande()">
    <div class="qrcode-sync-modal-content" (click)="$event.stopPropagation()">
      <h3>Sincronize o WhatsApp</h3>
      <p>Escaneie o QR Code abaixo com o WhatsApp para ativar o envio automático:</p>
      <img [src]="qrCodeBase64.startsWith('data:image') ? qrCodeBase64 : 'data:image/png;base64,' + qrCodeBase64"
           alt="QR Code WhatsApp"
           style="max-width: 300px; border: 2px solid #ccc; border-radius: 8px;" />
      <button (click)="fecharQrCodeGrande()" style="margin-top: 1rem;">Fechar</button>
    </div>
  </div>
</div>


