<div class="container py-5">
  <!-- Título Principal -->
  <h2 class="text-center text-primary mb-4 fw-bold">Atendimentos de Serviço</h2>

  <!-- Formulário de Atendimento -->
  <form
    #atendimentoForm="ngForm"
    (ngSubmit)="onSubmit(atendimentoForm)"
    class="card shadow-lg p-4 mb-5 bg-light rounded"
  >
    <div class="row">
      <!-- Código do Atendimento -->
      <div class="col-md-6 mb-3">
        <label for="CodAtend" class="form-label fw-bold">Código do Atendimento:</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="codAtend"
          name="CodAtend"
          readonly
          required
        />
      </div>

      <!-- Nome do Cliente -->
      <div class="col-md-6 mb-3">
        <label for="NomeCliente" class="form-label fw-bold">Nome do Cliente:</label>
        <input
          type="text"
          class="form-control"
          [value]="getNomeCliente(codAtend)"
          name="NomeCliente"
          readonly
          required
        />
      </div>
    </div>

    <div class="row">
      <!-- Serviço -->
      <div class="col-md-6 mb-3">
        <label for="CodServ" class="form-label fw-bold">Serviço:</label>
        <select
          class="form-select"
          [(ngModel)]="atendimento.CodServ"
          name="CodServ"
          required
        >
          <option value="" disabled>Selecione um serviço</option>
          <option *ngFor="let servico of servicos" [value]="servico.CodServ">
            {{ servico.DsServ }}
          </option>
        </select>
      </div>

      <!-- Profissional -->
      <div class="col-md-6 mb-3">
        <label for="CodProf" class="form-label fw-bold">Profissional:</label>
        <select
          class="form-select"
          [(ngModel)]="atendimento.CodProf"
          name="CodProf"
        >
          <option value="" disabled>Selecione um profissional</option>
          <option *ngFor="let profissional of profissionais" [value]="profissional.CodProf">
            {{ profissional.NmProf }}
          </option>
        </select>
      </div>
    </div>

    <div class="row">
      <!-- Data e Hora -->
      <div class="col-md-6 mb-3">
        <label for="DtAgen" class="form-label fw-bold">Data e Hora de Agendamento:</label>
        <input
          type="datetime-local"
          class="form-control"
          [(ngModel)]="atendimento.DtAgen"
          name="DtAgen"
          required
          step="900"
          placeholder="Selecione a data e hora"
        />
      </div>

      <!-- Valor do Serviço -->
      <div class="col-md-6 mb-3">
        <label for="VrServ" class="form-label fw-bold">Valor do Serviço (R$):</label>
        <input
          type="number"
          class="form-control"
          [(ngModel)]="atendimento.VrServ"
          name="VrServ"
          min="0"
          step="0.01"
          placeholder="0.00"
          required
        />
      </div>
    </div>

    <div class="row">
      <!-- Comissão -->
      <div class="col-md-6 mb-3">
        <label for="PercComis" class="form-label fw-bold">Comissão (%):</label>
        <input
          type="number"
          class="form-control"
          [(ngModel)]="atendimento.PercComis"
          name="PercComis"
          min="0"
          max="100"
          step="0.01"
          placeholder="0.00"
          required
        />
      </div>

      <!-- Percentual de Desconto -->
      <div class="col-md-6 mb-3">
        <label for="Percdes" class="form-label fw-bold">Percentual de Desconto (%):</label>
        <input
          type="number"
          class="form-control"
          [(ngModel)]="atendimento.Percdes"
          name="Percdes"
          min="0"
          max="100"
          step="0.01"
          placeholder="0.00"
        />
      </div>
    </div>

    <div class="row">
      <!-- Tipo de Pagamento -->
      <div class="col-md-6 mb-3">
        <label for="Tppgto" class="form-label fw-bold">Tipo de Pagamento:</label>
        <select
          class="form-select"
          [(ngModel)]="atendimento.Tppgto"
          name="Tppgto"
          required
        >
          <option value="" disabled>Selecione o tipo de pagamento</option>
          <option *ngFor="let tipo of tiposPagamento" [value]="tipo.id">
            {{ tipo.nome }}
          </option>
        </select>
      </div>

      <!-- Status do Pagamento -->
      <div class="col-md-6 mb-3">
        <label for="Stapgto" class="form-label fw-bold">Status do Pagamento:</label>
        <select
          class="form-select"
          [(ngModel)]="atendimento.Stapgto"
          name="Stapgto"
        >
          <option value="" disabled>Selecione o status</option>
          <option *ngFor="let status of statusPagamento" [value]="status.id">
            {{ status.nome }}
          </option>
        </select>
      </div>
    </div>

    <!-- Observações -->
    <div class="mb-3">
      <label for="Obs" class="form-label fw-bold">Observações:</label>
      <textarea
        [(ngModel)]="atendimento.Obs"
        name="Obs"
        rows="3"
        class="form-control"
      ></textarea>
    </div>

    <!-- Data de Pagamento -->
    <div class="mb-3">
      <label for="Dtpgto" class="form-label fw-bold">Data de Pagamento:</label>
      <input
        type="date"
        class="form-control"
        [(ngModel)]="atendimento.Dtpgto"
        name="Dtpgto"
        required
      />
    </div>

    <!-- Botões -->
    <div class="d-flex justify-content-between">
      <button
        type="submit"
        class="btn btn-success shadow-sm"
        [disabled]="atendimentoForm.invalid"
      >
        {{ isEditing ? 'Atualizar' : 'Adicionar' }}
      </button>
      <button class="btn btn-secondary shadow-sm" (click)="voltar()">
        Voltar
      </button>
    </div>

    <!-- Mensagens -->
    <div *ngIf="successMessage" class="alert alert-success mt-3">
      {{ successMessage }}
    </div>
    <div *ngIf="errorMessage" class="alert alert-danger mt-3">
      {{ errorMessage }}
    </div>
  </form>

  <!-- Lista de Atendimentos -->
  <h3 class="text-center text-secondary mt-4 fw-bold border-bottom pb-2">Lista de Atendimentos</h3>
  <div class="table-responsive">
    <table class="table table-bordered table-hover shadow-lg">
      <thead class="table-dark">
        <tr>
          <th class="text-center">Código</th>
          <th>Serviço</th>
          <th>Data e Hora</th>
          <th>Profissional</th>
          <th>Valor (R$)</th>
          <th>Comissão (%)</th>
          <th>Observações</th>
          <th class="text-center">Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let atendimento of atendServs" class="align-middle">
          <td class="text-center">{{ atendimento.CodAtend }}</td>
          <td>{{ getServicoNome(atendimento.CodServ) }}</td>
          <td>{{ atendimento.DtAgen | date: 'dd-MM-yyyy HH:mm' }}</td>
          <td>{{ getNomeProfissional(atendimento.CodProf) }}</td>
          <td>{{ atendimento.VrServ | number: '1.2-2' }}</td>
          <td>{{ atendimento.PercComis | number: '1.2-2' }}</td>
          <td>{{ atendimento.Obs }}</td>
          <td class="text-center">
            <button
              class="btn btn-warning btn-sm shadow-sm me-2"
              (click)="editAtendServ(atendimento.CodAtend, atendimento.CodServ)"
            >
              <i class="bi bi-pencil-square"></i> Editar
            </button>
            <button
              class="btn btn-danger btn-sm shadow-sm"
              (click)="deleteAtendServ(atendimento.CodAtend, atendimento.CodServ)"
            >
              <i class="bi bi-trash"></i> Excluir
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>